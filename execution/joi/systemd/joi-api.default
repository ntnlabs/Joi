# /etc/default/joi-api
# Environment variables for Joi API service
# Copy to /etc/default/joi-api and adjust as needed

# --- Core ---
JOI_BIND_HOST=0.0.0.0
JOI_BIND_PORT=8443
#JOI_LOG_LEVEL=DEBUG

# --- LLM ---
JOI_OLLAMA_URL=http://localhost:11434
JOI_OLLAMA_MODEL=llama3
JOI_LLM_TIMEOUT=180
# Context window size (0 = use model default, typically 2048-4096)
# Higher = more context but more VRAM. 4096 is safe for 12GB cards.
#JOI_OLLAMA_NUM_CTX=4096

# --- Mesh ---
# Mesh proxy URL (Nebula IP)
JOI_MESH_URL=http://10.42.0.1:8444

# --- Memory ---
JOI_MEMORY_DB=/var/lib/joi/memory.db
JOI_CONTEXT_MESSAGES=50
# Require encrypted database (set to 0 to allow unencrypted - NOT RECOMMENDED)
JOI_REQUIRE_ENCRYPTED_DB=1

# --- Compaction ---
# When messages exceed context size, compact oldest N messages
# Constraint: 10 <= batch < context // 2
JOI_COMPACT_BATCH_SIZE=20
# Set to 1 to archive messages instead of deleting
JOI_CONSOLIDATION_ARCHIVE=0
# Optional: separate model for fact extraction (low temperature recommended)
#JOI_CONSOLIDATION_MODEL=joi-consolidator

# --- RAG ---
# Set to 0 to disable knowledge retrieval
JOI_RAG_ENABLED=1
# Max tokens for RAG context in prompts
JOI_RAG_MAX_TOKENS=500

# --- Time Awareness ---
# Set to 1 to inject current datetime into system prompt
# Enables appropriate greetings and understanding of relative time
JOI_TIME_AWARENESS=0
# User timezone in IANA format (e.g., Europe/Bratislava, America/New_York)
JOI_TIMEZONE=Europe/Bratislava

# --- Scheduler (Wind/Tasks) ---
# Background scheduler for proactive messaging and reminders
JOI_SCHEDULER_ENABLED=1
# Tick interval in seconds
JOI_SCHEDULER_INTERVAL=60
# Seconds to wait after startup before first tick
JOI_SCHEDULER_STARTUP_DELAY=10

# --- Prompts ---
# Directory for per-user and per-group system prompts
JOI_PROMPTS_DIR=/var/lib/joi/prompts

# --- HMAC Authentication (defense-in-depth over Nebula) ---
# Shared secret for HMAC verification (MUST match MESH_HMAC_SECRET on Mesh VM)
# Generate with: openssl rand -hex 32
JOI_HMAC_SECRET=<your-256-bit-hex-secret>
# Timestamp tolerance in milliseconds (default: 300000 = 5 minutes)
# JOI_HMAC_TIMESTAMP_TOLERANCE_MS=300000

# --- Encryption (future) ---
# SQLCipher encryption key - uncomment when ready
# JOI_MEMORY_KEY=<generate-with-openssl-rand-base64-32>
